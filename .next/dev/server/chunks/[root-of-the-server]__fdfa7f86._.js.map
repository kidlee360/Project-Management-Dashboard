{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Documents/CORRECTIONNNNNN/Project-Management-Dashboard/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\r\n\r\n// Vercel and most cloud hosting platforms prefer a single DATABASE_URL connection string.\r\n// This is the most reliable way to connect.\r\nconst connectionString = process.env.DATABASE_URL;\r\n\r\nif (!connectionString) {\r\n  // Log a severe error if the connection string is missing before trying to connect\r\n  console.error(\"FATAL ERROR: DATABASE_URL environment variable is not set.\");\r\n  // Throwing an error here prevents the app from proceeding with a guaranteed failed connection.\r\n  throw new Error(\"DATABASE_URL is missing.\");\r\n}\r\n\r\n\r\nconst pool = new Pool({\r\n  // Use the single connection string\r\n  connectionString: connectionString,\r\n  // *** CRITICAL ADDITIONS FOR VERCEL/SUPABASE ***\r\n  max: 2, // Limit connections to prevent serverless function memory exhaustion\r\n  idleTimeoutMillis: 30000, // Close idle connections after 30 seconds\r\n  connectionTimeoutMillis: 10000, // Timeout connection after 10 seconds (increased from 2)\r\n  // Add SSL settings required by Supabase/Render/many hosts for secure connection\r\n  ssl: {\r\n    // This allows the connection even if the certificate cannot be verified, \r\n    // which is common in development or certain cloud environments.\r\n    rejectUnauthorized: false, \r\n  }\r\n});\r\n\r\nconsole.log('PostgreSQL Pool initialized using connectionString');\r\n\r\nexport default {\r\n  // Use 'any' type for params array to match common usage in existing code\r\n  query: (text: string, params: any[]) => pool.query(text, params),\r\n}"],"names":[],"mappings":";;;;AAAA;;AAEA,0FAA0F;AAC1F,4CAA4C;AAC5C,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;AAEjD,IAAI,CAAC,kBAAkB;IACrB,kFAAkF;IAClF,QAAQ,KAAK,CAAC;IACd,+FAA+F;IAC/F,MAAM,IAAI,MAAM;AAClB;AAGA,MAAM,OAAO,IAAI,qGAAI,CAAC;IACpB,mCAAmC;IACnC,kBAAkB;IAClB,iDAAiD;IACjD,KAAK;IACL,mBAAmB;IACnB,yBAAyB;IACzB,gFAAgF;IAChF,KAAK;QACH,0EAA0E;QAC1E,gEAAgE;QAChE,oBAAoB;IACtB;AACF;AAEA,QAAQ,GAAG,CAAC;uCAEG;IACb,yEAAyE;IACzE,OAAO,CAAC,MAAc,SAAkB,KAAK,KAAK,CAAC,MAAM;AAC3D","debugId":null}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Documents/CORRECTIONNNNNN/Project-Management-Dashboard/pages/api/tasks.ts"],"sourcesContent":["// pages/api/tasks.js (Requires the 'pages/api' folder structure)\r\nimport db from '@/lib/db';\r\nimport type { NextApiRequest, NextApiResponse } from 'next'; \r\nimport cookie from 'cookie';\r\n\r\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\r\n  const cookies = cookie.parse(req.headers.cookie || '');\r\n  if (req.method === 'GET') {\r\n    try {\r\n      const userId = cookies.user_id;\r\n      const result = await db.query(\r\n        'SELECT * FROM tasks WHERE user_id = $1 ORDER BY id ASC',\r\n        [userId]\r\n      );\r\n      // ðŸ’¡ Fix: Use the standard Pages Router method for JSON response\r\n      res.status(200).json(result.rows); \r\n    } catch (error) {\r\n      console.error('Database Error:', error);\r\n      res.status(500).json({ error: 'Failed to fetch tasks.' });\r\n    }\r\n  } else if (req.method === 'POST') {\r\n    try {\r\n      const [ task, description, due_date, columnname, priority ] = req.body;\r\n      const userId = cookies.user_id;\r\n        const result = await db.query(\r\n        'INSERT INTO tasks (task, description, due_date, columnname, priority, user_id) VALUES ($1, $2, $3, $4, $5, $6) RETURNING *',\r\n        [task, description, due_date, columnname, priority, userId]\r\n      );\r\n      res.status(201).json(result.rows[0]);\r\n    } catch (error) {\r\n      console.error('Database Error:', error);\r\n      res.status(500).json({ error: 'Failed to create task.' });\r\n    }\r\n  } else if(req.method === 'PUT'){\r\n    try {\r\n        const { id, task, description, due_date, columnname, priority } = req.body;\r\n        const userId = cookies.user_id;\r\n        const result = await db.query(\r\n            'UPDATE tasks SET task = $1, description = $2, due_date = $3, columnname = $4, priority = $5 WHERE id = $6 RETURNING *',\r\n            [task, description, due_date, columnname, priority, id]\r\n        );\r\n            res.status(200).json(result.rows[0])\r\n    } catch (error){\r\n        console.error('Database Error:', error);\r\n        res.status(500).json({ error: 'Failed to update task.' });\r\n    }\r\n  } else if(req.method === 'DELETE'){\r\n    try {\r\n        // 1. Get the task ID from the request body\r\n        // Note: DELETE requests typically send data in the body or query params.\r\n        // Sending in the body (req.body) is often cleaner for complex data.\r\n        const { id } = req.body; \r\n        const userId = cookies.user_id; // Assuming auth checks later\r\n\r\n        // 2. Execute the PostgreSQL DELETE command\r\n        const result = await db.query(\r\n            'DELETE FROM tasks WHERE id = $1 AND user_id = $2 RETURNING id',\r\n            [id, userId] // Use parameterized query for security\r\n        );\r\n\r\n        // 3. Check if a row was actually deleted\r\n        if (result.rowCount === 0) {\r\n            // Task not found or not owned by the user\r\n            return res.status(404).json({ error: 'Task not found or unauthorized.' });\r\n        }\r\n\r\n        // 4. Send a success response (typically status 204 or the ID of the deleted item)\r\n        // 200 is also acceptable if you want to send JSON back.\r\n        res.status(200).json({ id: id, message: 'Task deleted successfully.' });\r\n\r\n    } catch (error) {\r\n        console.error('Database Delete Error:', error);\r\n        res.status(500).json({ error: 'Failed to delete task.' });\r\n    }\r\n  } else if (req.method === 'PATCH') {\r\n    try {\r\n        const { id, columnname } = req.body;\r\n        if (!id || !columnname) {\r\n            return res.status(400).json({ error: 'Task ID and column name are required.' });\r\n        }\r\n        const result = await db.query(\r\n            'UPDATE tasks SET columnname = $1 WHERE id = $2 RETURNING *',\r\n            [columnname, id]\r\n        );\r\n        if (result.rowCount === 0) {\r\n            return res.status(404).json({ error: 'Task not found.' });\r\n        }\r\n        res.status(200).json(result.rows[0]);\r\n    } catch (error) {\r\n        console.error('Database Error:', error);\r\n        res.status(500).json({ error: 'Failed to update task column.' });\r\n    }\r\n  } else {\r\n    // Handle other methods like POST, PUT, DELETE\r\n    res.setHeader('Allow', ['GET', 'POST', 'PUT', 'DELETE', 'PATCH']);\r\n    res.status(405).end(`Method ${req.method} Not Allowed`);\r\n  }\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}