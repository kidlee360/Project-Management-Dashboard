{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Downloads/test/gemini-next-app/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  user: process.env.PGSQL_USER,\n  password: process.env.PGSQL_PASSWORD,\n  host: process.env.PGSQL_HOST,\n  port: process.env.PGSQL_PORT ? parseInt(process.env.PGSQL_PORT, 10) : undefined,\n  database: process.env.PGSQL_DATABASE,\n});\n\nexport default pool;"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,OAAO,IAAI,qGAAI,CAAC;IACpB,MAAM,QAAQ,GAAG,CAAC,UAAU;IAC5B,UAAU,QAAQ,GAAG,CAAC,cAAc;IACpC,MAAM,QAAQ,GAAG,CAAC,UAAU;IAC5B,MAAM,QAAQ,GAAG,CAAC,UAAU,GAAG,SAAS,QAAQ,GAAG,CAAC,UAAU,EAAE,MAAM;IACtE,UAAU,QAAQ,GAAG,CAAC,cAAc;AACtC;uCAEe","debugId":null}},
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Downloads/test/gemini-next-app/pages/api/users.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next';\nimport pool from '@/lib/db';\nimport bcrypt from 'bcryptjs';\n\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method === 'POST') {\n    const {username, email, password, account} = req.body;\n    if (account){\n    try {\n      if (!username || !password) {\n        return res.status(400).json({ message: 'Username and password are required' });\n      }\n      const result  = await pool.query(\n        'SELECT * FROM users WHERE username = $1 OR email = $2',\n        [username, email]\n      );\n      const user = result.rows[0];\n      if (!user) {\n        return res.status(401).json({ message: 'Invalid credentials' });\n      }\n      const isPasswordValid = await bcrypt.compare(password, user.password);\n      if (!isPasswordValid) {\n        return res.status(401).json({ message: 'Invalid credentials' });\n      }\n      res.setHeader('Set-Cookie', [\n        `user_id=${user.id}; HttpOnly; Path=/; Max-Age=60*60*24*7; Secure; SameSite=Lax`\n      ]);\n      res.status(201).json({ message: 'Login successful'});\n      return(user.id);\n    } catch (error) {\n      res.status(500).json({ message: 'Internal server error' });\n\n\n    }}else{  \n    try {\n      if (!username || !email || !password) {\n        return res.status(400).json({ message: 'Username, email and password are required' });\n      }\n      const cUser  = await pool.query(\n        'SELECT * FROM users WHERE username = $1 AND email = $2',\n        [username, email]\n      );\n      if (cUser.rows.length > 0) {\n        return res.status(401).json({ message: 'User already exists' });\n      }\n      const hashedPassword = await bcrypt.hash(password, 10);\n      const user = await pool.query(\n        'INSERT INTO users (username, email, password) VALUES ($1, $2, $3) RETURNING *',\n        [username, email, hashedPassword]\n      );\n      res.setHeader('Set-Cookie', [\n        `user_id=${user.rows[0].id}; HttpOnly; Path=/; Max-Age=60*60*24*7; Secure; SameSite=Lax`\n      ]);\n      res.status(201).json({ message: 'User created successfully' });\n    } catch (error) {\n      res.status(500).json({ message: 'Internal server error. It did not work' });\n    }}\n\n  } else {\n    res.setHeader('Allow', ['POST']);\n    res.status(405).end(`Method ${req.method} Not Allowed`);\n  }\n}\n"],"names":[],"mappings":";;;;AACA;AACA;;;;;;;AAGe,eAAe,QAC5B,GAAmB,EACnB,GAAoB;IAEpB,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,MAAM,EAAC,QAAQ,EAAE,KAAK,EAAE,QAAQ,EAAE,OAAO,EAAC,GAAG,IAAI,IAAI;QACrD,IAAI,SAAQ;YACZ,IAAI;gBACF,IAAI,CAAC,YAAY,CAAC,UAAU;oBAC1B,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;wBAAE,SAAS;oBAAqC;gBAC9E;gBACA,MAAM,SAAU,MAAM,6GAAI,CAAC,KAAK,CAC9B,yDACA;oBAAC;oBAAU;iBAAM;gBAEnB,MAAM,OAAO,OAAO,IAAI,CAAC,EAAE;gBAC3B,IAAI,CAAC,MAAM;oBACT,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;wBAAE,SAAS;oBAAsB;gBAC/D;gBACA,MAAM,kBAAkB,MAAM,2HAAM,CAAC,OAAO,CAAC,UAAU,KAAK,QAAQ;gBACpE,IAAI,CAAC,iBAAiB;oBACpB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;wBAAE,SAAS;oBAAsB;gBAC/D;gBACA,IAAI,SAAS,CAAC,cAAc;oBAC1B,CAAC,QAAQ,EAAE,KAAK,EAAE,CAAC,4DAA4D,CAAC;iBACjF;gBACD,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;oBAAE,SAAS;gBAAkB;gBAClD,OAAO,KAAK,EAAE;YAChB,EAAE,OAAO,OAAO;gBACd,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;oBAAE,SAAS;gBAAwB;YAG1D;QAAC,OAAK;YACN,IAAI;gBACF,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,UAAU;oBACpC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;wBAAE,SAAS;oBAA4C;gBACrF;gBACA,MAAM,QAAS,MAAM,6GAAI,CAAC,KAAK,CAC7B,0DACA;oBAAC;oBAAU;iBAAM;gBAEnB,IAAI,MAAM,IAAI,CAAC,MAAM,GAAG,GAAG;oBACzB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;wBAAE,SAAS;oBAAsB;gBAC/D;gBACA,MAAM,iBAAiB,MAAM,2HAAM,CAAC,IAAI,CAAC,UAAU;gBACnD,MAAM,OAAO,MAAM,6GAAI,CAAC,KAAK,CAC3B,iFACA;oBAAC;oBAAU;oBAAO;iBAAe;gBAEnC,IAAI,SAAS,CAAC,cAAc;oBAC1B,CAAC,QAAQ,EAAE,KAAK,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,4DAA4D,CAAC;iBACzF;gBACD,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;oBAAE,SAAS;gBAA4B;YAC9D,EAAE,OAAO,OAAO;gBACd,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;oBAAE,SAAS;gBAAyC;YAC3E;QAAC;IAEH,OAAO;QACL,IAAI,SAAS,CAAC,SAAS;YAAC;SAAO;QAC/B,IAAI,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC,OAAO,EAAE,IAAI,MAAM,CAAC,YAAY,CAAC;IACxD;AACF","debugId":null}}]
}