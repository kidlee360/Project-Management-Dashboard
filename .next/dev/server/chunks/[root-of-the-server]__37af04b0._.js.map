{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Documents/Project%20Management%20Dashboard/Project-Management-Dashboard/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\r\n\r\n// Vercel and most cloud hosting platforms prefer a single DATABASE_URL connection string.\r\n// This is the most reliable way to connect.\r\nconst connectionString = process.env.DATABASE_URL;\r\n\r\nif (!connectionString) {\r\n  // Log a severe error if the connection string is missing before trying to connect\r\n  console.error(\"FATAL ERROR: DATABASE_URL environment variable is not set.\");\r\n  // Throwing an error here prevents the app from proceeding with a guaranteed failed connection.\r\n  throw new Error(\"DATABASE_URL is missing.\");\r\n}\r\n\r\n\r\nconst pool = new Pool({\r\n  // Use the single connection string\r\n  connectionString: connectionString,\r\n  // *** CRITICAL ADDITIONS FOR VERCEL/SUPABASE ***\r\n  max: 2, // Limit connections to prevent serverless function memory exhaustion\r\n  idleTimeoutMillis: 30000, // Close idle connections after 30 seconds\r\n  connectionTimeoutMillis: 10000, // Timeout connection after 10 seconds (increased from 2)\r\n  // Add SSL settings required by Supabase/Render/many hosts for secure connection\r\n  ssl: {\r\n    // This allows the connection even if the certificate cannot be verified, \r\n    // which is common in development or certain cloud environments.\r\n    rejectUnauthorized: false, \r\n  }\r\n});\r\n\r\nconsole.log('PostgreSQL Pool initialized using connectionString');\r\n\r\nexport default {\r\n  // Use 'any' type for params array to match common usage in existing code\r\n  query: (text: string, params: any[]) => pool.query(text, params),\r\n}"],"names":[],"mappings":";;;;AAAA;;AAEA,0FAA0F;AAC1F,4CAA4C;AAC5C,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;AAEjD,IAAI,CAAC,kBAAkB;IACrB,kFAAkF;IAClF,QAAQ,KAAK,CAAC;IACd,+FAA+F;IAC/F,MAAM,IAAI,MAAM;AAClB;AAGA,MAAM,OAAO,IAAI,qGAAI,CAAC;IACpB,mCAAmC;IACnC,kBAAkB;IAClB,iDAAiD;IACjD,KAAK;IACL,mBAAmB;IACnB,yBAAyB;IACzB,gFAAgF;IAChF,KAAK;QACH,0EAA0E;QAC1E,gEAAgE;QAChE,oBAAoB;IACtB;AACF;AAEA,QAAQ,GAAG,CAAC;uCAEG;IACb,yEAAyE;IACzE,OAAO,CAAC,MAAc,SAAkB,KAAK,KAAK,CAAC,MAAM;AAC3D","debugId":null}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Documents/Project%20Management%20Dashboard/Project-Management-Dashboard/pages/api/users.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next';\r\nimport pool from '@/lib/db';\r\nimport bcrypt from 'bcryptjs';\r\n\r\n\r\nexport default async function handler(\r\n  req: NextApiRequest,\r\n  res: NextApiResponse\r\n) {\r\n  if (req.method === 'POST') {\r\n    const {username, email, password, account} = req.body;\r\n    if (account){\r\n    try {\r\n      if (!username || !password) {\r\n        return res.status(400).json({ message: 'Username and password are required' });\r\n      }\r\n      const result  = await pool.query(\r\n        'SELECT * FROM users WHERE username = $1 OR email = $2',\r\n        [username, email]\r\n      );\r\n      const user = result.rows[0];\r\n      if (!user) {\r\n        return res.status(401).json({ message: 'Invalid credentials' });\r\n      }\r\n      const isPasswordValid = await bcrypt.compare(password, user.password);\r\n      if (!isPasswordValid) {\r\n        return res.status(401).json({ message: 'Invalid credentials' });\r\n      }\r\n      res.setHeader('Set-Cookie', [\r\n        `user_id=${user.id}; HttpOnly; Path=/; Max-Age=60*60*24*7; Secure; SameSite=Lax`\r\n      ]);\r\n      res.status(201).json({ message: 'Login successful'});\r\n      return(user.id);\r\n    } catch (error) {\r\n      res.status(500).json({ message: 'Internal server error' });\r\n\r\n\r\n    }}else{  \r\n    try {\r\n      if (!username || !email || !password) {\r\n        return res.status(400).json({ message: 'Username, email and password are required' });\r\n      }\r\n      const cUser  = await pool.query(\r\n        'SELECT * FROM users WHERE username = $1 AND email = $2',\r\n        [username, email]\r\n      );\r\n      if (cUser.rows.length > 0) {\r\n        return res.status(401).json({ message: 'User already exists' });\r\n      }\r\n      const hashedPassword = await bcrypt.hash(password, 10);\r\n      const user = await pool.query(\r\n        'INSERT INTO users (username, email, password) VALUES ($1, $2, $3) RETURNING *',\r\n        [username, email, hashedPassword]\r\n      );\r\n      res.setHeader('Set-Cookie', [\r\n        `user_id=${user.rows[0].id}; HttpOnly; Path=/; Max-Age=60*60*24*7; Secure; SameSite=Lax`\r\n      ]);\r\n      res.status(201).json({ message: 'User created successfully' });\r\n    } catch (error) {\r\n      res.status(500).json({ message: 'Internal server error. It did not work' });\r\n    }}\r\n\r\n  } else {\r\n    res.setHeader('Allow', ['POST']);\r\n    res.status(405).end(`Method ${req.method} Not Allowed`);\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AACA;AACA;;;;;;;AAGe,eAAe,QAC5B,GAAmB,EACnB,GAAoB;IAEpB,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,MAAM,EAAC,QAAQ,EAAE,KAAK,EAAE,QAAQ,EAAE,OAAO,EAAC,GAAG,IAAI,IAAI;QACrD,IAAI,SAAQ;YACZ,IAAI;gBACF,IAAI,CAAC,YAAY,CAAC,UAAU;oBAC1B,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;wBAAE,SAAS;oBAAqC;gBAC9E;gBACA,MAAM,SAAU,MAAM,6GAAI,CAAC,KAAK,CAC9B,yDACA;oBAAC;oBAAU;iBAAM;gBAEnB,MAAM,OAAO,OAAO,IAAI,CAAC,EAAE;gBAC3B,IAAI,CAAC,MAAM;oBACT,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;wBAAE,SAAS;oBAAsB;gBAC/D;gBACA,MAAM,kBAAkB,MAAM,2HAAM,CAAC,OAAO,CAAC,UAAU,KAAK,QAAQ;gBACpE,IAAI,CAAC,iBAAiB;oBACpB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;wBAAE,SAAS;oBAAsB;gBAC/D;gBACA,IAAI,SAAS,CAAC,cAAc;oBAC1B,CAAC,QAAQ,EAAE,KAAK,EAAE,CAAC,4DAA4D,CAAC;iBACjF;gBACD,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;oBAAE,SAAS;gBAAkB;gBAClD,OAAO,KAAK,EAAE;YAChB,EAAE,OAAO,OAAO;gBACd,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;oBAAE,SAAS;gBAAwB;YAG1D;QAAC,OAAK;YACN,IAAI;gBACF,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,UAAU;oBACpC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;wBAAE,SAAS;oBAA4C;gBACrF;gBACA,MAAM,QAAS,MAAM,6GAAI,CAAC,KAAK,CAC7B,0DACA;oBAAC;oBAAU;iBAAM;gBAEnB,IAAI,MAAM,IAAI,CAAC,MAAM,GAAG,GAAG;oBACzB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;wBAAE,SAAS;oBAAsB;gBAC/D;gBACA,MAAM,iBAAiB,MAAM,2HAAM,CAAC,IAAI,CAAC,UAAU;gBACnD,MAAM,OAAO,MAAM,6GAAI,CAAC,KAAK,CAC3B,iFACA;oBAAC;oBAAU;oBAAO;iBAAe;gBAEnC,IAAI,SAAS,CAAC,cAAc;oBAC1B,CAAC,QAAQ,EAAE,KAAK,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,4DAA4D,CAAC;iBACzF;gBACD,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;oBAAE,SAAS;gBAA4B;YAC9D,EAAE,OAAO,OAAO;gBACd,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;oBAAE,SAAS;gBAAyC;YAC3E;QAAC;IAEH,OAAO;QACL,IAAI,SAAS,CAAC,SAAS;YAAC;SAAO;QAC/B,IAAI,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC,OAAO,EAAE,IAAI,MAAM,CAAC,YAAY,CAAC;IACxD;AACF","debugId":null}}]
}